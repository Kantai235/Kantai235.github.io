{{ $recentArticles := 5 }}
{{ $recentArticles = .Site.Params.homepage.showRecentItems }}

{{/* Get pages from the default language (zh-tw) site */}}
{{ $zhtwSites := where site.Sites ".Language.Lang" "zh-tw" }}
{{ $pages := slice }}

{{ if $zhtwSites }}
  {{ $zhtwSite := index $zhtwSites 0 }}
  {{ $pages = first $recentArticles (where $zhtwSite.RegularPages "Type" "in" site.Params.mainSections) }}
{{ else }}
  {{ $pages = first $recentArticles (where .Site.RegularPages "Type" "in" .Site.Params.mainSections) }}
{{ end }}

<section class="space-y-10 w-full">
  {{ range $pages }}
    {{ $currentLang := $.Site.Language.Lang }}
    {{ $currentPage := . }}
    {{ if eq $currentLang "zh-tw" }}
      {{ partial "article-link/simple.html" . }}
    {{ else }}
      {{/* Generate URL for current language */}}
      {{ $newURL := "" }}
      {{ if eq $currentLang "en" }}
        {{ $newURL = printf "/en%s" .RelPermalink }}
      {{ else if eq $currentLang "ja" }}
        {{ $newURL = printf "/ja%s" .RelPermalink }}
      {{ end }}
      
      {{/* Custom article link with correct URL */}}
      <div class="group-hover-card group flex flex-wrap md:flex-nowrap article relative">
        <a href="{{ $newURL }}" class="absolute inset-0" aria-label="{{ .Title }}"></a>
        {{/* Feature image handling */}}
        {{- $images := .Resources.ByType "image" -}}
        {{- $featured := $images.GetMatch "*feature*" -}}
        {{- if not $featured }}{{ $featured = $images.GetMatch "{*cover*,*thumbnail*}" }}{{ end -}}
        {{ if and .Params.featureimage (not $featured) }}
          {{- $url:= .Params.featureimage -}}
          {{ $featured = resources.GetRemote $url }}
        {{ end }}
        {{- if not $featured }}
          {{ with .Site.Params.defaultFeaturedImage }}{{ $featured = resources.Get . }}{{ end }}
        {{ end -}}
        {{ if .Params.hideFeatureImage }}{{ $featured = false }}{{ end }}
        {{- with $featured -}}
          {{ $disableImageOptimization := $.Site.Params.disableImageOptimization | default false }}
          {{ if or $disableImageOptimization (strings.HasSuffix $featured ".svg") }}
            <div class="w-full md:w-auto h-full thumbnail nozoom thumbnailshadow md:mr-7" style="background-image:url({{ .RelPermalink }});"></div>
          {{ else }}
            {{ with .Resize "600x" }}
              <div class="w-full md:w-auto h-full thumbnail nozoom thumbnailshadow md:mr-7" style="background-image:url({{ .RelPermalink }});"></div>
            {{ end }}
          {{ end }}
        {{- end -}}
        
        <div class="mt-3 md:mt-0">
          <div class="items-center text-left text-xl font-semibold">
            <div class="group-hover-card-title decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 group-hover:underline group-hover:underline-offset-2">
              {{ .Title | emojify }}
            </div>
            {{ if and .Draft .Site.Params.article.showDraftLabel }}
              <div class="ltr:ml-2 rtl:mr-2">{{ partial "badge.html" (i18n "article.draft" | emojify) }}</div>
            {{ end }}
          </div>
          <div class="group-hover-cancel text-sm text-neutral-500 dark:text-neutral-400">
            {{ partial "article-meta/basic.html" . }}
          </div>
          {{ if .Params.showSummary | default (.Site.Params.list.showSummary | default false) }}
            <div class="prose dark:prose-invert max-w-fit py-1">{{ .Summary | plainify }}</div>
          {{ end }}
        </div>
      </div>
    {{ end }}
  {{ end }}
</section>